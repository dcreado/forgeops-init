{
  "metadata" : {
    "realm" : "/",
    "amsterVersion" : "6.5.2",
    "entityType" : "Scripts",
    "entityId" : "a50fb1fb-664f-4f74-94d7-7544a858f656",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "a50fb1fb-664f-4f74-94d7-7544a858f656",
    "name" : "delegated_access_token",
    "description" : null,
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMTkgRm9yZ2VSb2NrIEFTLiBBbGwgUmlnaHRzIFJlc2VydmVkCiAqCiAqIFVzZSBvZiB0aGlzIGNvZGUgcmVxdWlyZXMgYSBjb21tZXJjaWFsIHNvZnR3YXJlIGxpY2Vuc2Ugd2l0aCBGb3JnZVJvY2sgQVMuCiAqIG9yIHdpdGggb25lIG9mIGl0cyBhZmZpbGlhdGVzLiBBbGwgdXNlIHNoYWxsIGJlIGV4Y2x1c2l2ZWx5IHN1YmplY3QKICogdG8gc3VjaCBsaWNlbnNlIGJldHdlZW4gdGhlIGxpY2Vuc2VlIGFuZCBGb3JnZVJvY2sgQVMuCiAqLwoKaW1wb3J0IG9yZy5mb3JnZXJvY2suaHR0cC5wcm90b2NvbC5SZXF1ZXN0CmltcG9ydCBvcmcuZm9yZ2Vyb2NrLmh0dHAucHJvdG9jb2wuUmVzcG9uc2UKCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCgppbXBvcnQgZ3Jvb3Z5Lmpzb24uSnNvblNsdXJwZXIKCi8qKgogKiBEZWZpbmVkIHZhcmlhYmxlczoKICogYWNjZXNzVG9rZW4gLSBUaGUgYWNjZXNzIHRva2VuIHRvIGJlIHVwZGF0ZWQuIE11dGFibGUgb2JqZWN0LCBhbGwgY2hhbmdlcyB0byB0aGUgYWNjZXNzIHRva2VuIHdpbGwgYmUgcmVmbGVjdGVkLgogKiBodHRwQ2xpZW50IC0gYWx3YXlzIHByZXNlbnQsIHRoZSBIVFRQIGNsaWVudCB0aGF0IGNhbiBiZSB1c2VkIHRvIG1ha2UgZXh0ZXJuYWwgSFRUUCByZXF1ZXN0cwogKiBpZGVudGl0eSAtIGFsd2F5cyBwcmVzZW50LCB0aGUgaWRlbnRpdHkgb2YgdGhlIHJlc291cmNlIG93bmVyCiAqIGxvZ2dlciAtIGFsd2F5cyBwcmVzZW50LCBjb3JyZXNwb25kaW5nIGxvZyBmaWxlcyB3aWxsIGJlIHByZWZpeGVkIHdpdGg6IHNjcmlwdHMuT0FVVEgyX0FDQ0VTU19UT0tFTl9NT0RJRklDQVRJT04uCiAqIHNjb3BlcyAtIGFsd2F5cyBwcmVzZW50LCB0aGUgcmVxdWVzdGVkIHNjb3BlcwogKiBzZXNzaW9uIC0gcHJlc2VudCBpZiB0aGUgcmVxdWVzdCBjb250YWlucyB0aGUgc2Vzc2lvbiBjb29raWUsIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBvYmplY3QKICoKICogTm8gcmV0dXJuIHZhbHVlIC0gY2hhbmdlcyBzaGFsbCBiZSBtYWRlIHRvIHRoZSBhY2Nlc3NUb2tlbiBwYXJhbWV0ZXIgZGlyZWN0bHkuCiAqCiAqIFRoZSBjaGFuZ2VzIG1hZGUgdG8gT0F1dGgyIGFjY2VzcyB0b2tlbnMgd2lsbCBkaXJlY3RseSBpbXBhY3QgdGhlIHNpemUgb2YgdGhlIENUUyB0b2tlbnMsIGFuZCBzaW1pbGFybHkgdGhlIHNpemUgb2YKICogdGhlIEpXVHMgaWYgY2xpZW50IGJhc2VkIE9BdXRoMiB0b2tlbnMgYXJlIHV0aWxpc2VkLgogKiBXaGVuIGFkZGluZy91cGRhdGluZyBmaWVsZHMgbWFrZSBzdXJlIHRoYXQgdGhlIHRva2VuIHNpemUgcmVtYWlucyB3aXRoaW4gY2xpZW50L3VzZXItYWdlbnQgbGltaXRzLgogKi8KCmFjY2Vzc1Rva2VuLnNldEZpZWxkcyhzZXNzaW9uLmdldFByb3BlcnRpZXMoKSk7CgovKgovL0ZpZWxkIHRvIGFsd2F5cyBpbmNsdWRlIGluIHRva2VuCmFjY2Vzc1Rva2VuLnNldEZpZWxkKCJoZWxsbyIsICJ3b3JsZCIpCgoKLy9PYnRhaW4gYWRkaXRpb25hbCB2YWx1ZXMgYnkgcGVyZm9ybWluZyBhIFJFU1QgY2FsbCB0byBhbiBleHRlcm5hbCBzZXJ2aWNlCnRyeSB7CiAgICBSZXNwb25zZSByZXNwb25zZSA9IGh0dHBDbGllbnQuc2VuZChuZXcgUmVxdWVzdCgpCiAgICAgICAgICAgIC5zZXRVcmkoImh0dHBzOi8vdGhpcmQucGFydHkuYXBwL2hlbGxvLmpzcCIpCiAgICAgICAgICAgIC5zZXRNZXRob2QoIlBPU1QiKQogICAgICAgICAgICAubW9kaWZ5SGVhZGVycyh7IGhlYWRlcnMgLT4gaGVhZGVycy5wdXQoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgiKSB9KQovLyAgICAgICAgICAuc2V0RW50aXR5KCdmb289YmFyJmhlbGxvPXdvcmxkJykpCiAgICAgICAgICAgIC5zZXRFbnRpdHkoW2ZvbzogJ2JhciddKSkKICAgICAgICAgICAgLmdldE9yVGhyb3coKQogICAgaWYgKHJlc3BvbnNlLnN0YXR1cy5zdWNjZXNzZnVsKSB7CiAgICAgICAgZGVmIHJlc3VsdCA9IG5ldyBKc29uU2x1cnBlcigpLnBhcnNlVGV4dChyZXNwb25zZS5lbnRpdHkuc3RyaW5nKQogICAgICAgIGFjY2Vzc1Rva2VuLnNldEZpZWxkcyhyZXN1bHQuZ2V0KCJ1cGRhdGVkRmllbGRzIikpCiAgICB9IGVsc2UgewogICAgICAgIGxvZ2dlci5lcnJvcigiVW5hYmxlIHRvIG9idGFpbiBhY2Nlc3MgdG9rZW4gbW9kaWZpY2F0aW9uczoge30sIHt9IiwgcmVzcG9uc2Uuc3RhdHVzLCByZXNwb25zZS5lbnRpdHkudG9TdHJpbmcoKSkKICAgIH0KfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZXgpIHsKICAgIGxvZ2dlci5lcnJvcigiVGhlIHJlcXVlc3QgcHJvY2Vzc2luZyB3YXMgaW50ZXJydXB0ZWQiLCBleCkKICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCkKICAgIC8vVGhlIGFjY2VzcyB0b2tlbiByZXF1ZXN0IHdpbGwgZmFpbCB3aXRoIEhUVFAgNTAwIGVycm9yIGluIHRoaXMgY2FzZS4KICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJVbmFibGUgdG8gb2J0YWluIHJlc3BvbnNlIGZyb20gIikKfQoKLy9BZGQgbmV3IGZpZWxkcyBjb250YWluaW5nIGlkZW50aXR5IGF0dHJpYnV0ZSB2YWx1ZXMKZGVmIGF0dHJpYnV0ZXMgPSBpZGVudGl0eS5nZXRBdHRyaWJ1dGVzKFsibWFpbCIsICJ0ZWxlcGhvbmVOdW1iZXIiXS50b1NldCgpKQphY2Nlc3NUb2tlbi5zZXRGaWVsZCgibWFpbCIsIGF0dHJpYnV0ZXNbIm1haWwiXSkKYWNjZXNzVG9rZW4uc2V0RmllbGQoInBob25lIiwgYXR0cmlidXRlc1sidGVsZXBob25lTnVtYmVyIl0pCgovL0FkZCBuZXcgZmllbGRzIGNvbnRhaW5pbmcgc2Vzc2lvbiBwcm9wZXJ0eSB2YWx1ZXMKaWYgKHNlc3Npb24gIT0gbnVsbCkgeyAvLyBzZXNzaW9uIGlzIG5vdCBhdmFpbGFibGUgZm9yIHJlc291cmNlIG93bmVyIHBhc3N3b3JkIGNyZWRlbnRpYWxzIGdyYW50CiAgICB0cnkgewogICAgICAgIGFjY2Vzc1Rva2VuLnNldEZpZWxkKCJpcEFkZHJlc3MiLCBzZXNzaW9uLmdldFByb3BlcnR5KCJIb3N0IikpCiAgICB9IGNhdGNoIChTU09FeGNlcHRpb24gZXgpIHsKICAgICAgICBsb2dnZXIuZXJyb3IoIlVuYWJsZSB0byByZXRyaWV2ZSBzZXNzaW9uIHByb3BlcnR5IHZhbHVlIiwgZXgpCiAgICB9Cn0KCi8vIFJlbW92ZSBhIG5hdGl2ZSBmaWVsZCBmcm9tIHRoZSB0b2tlbiBlbnRyeSwgdGhhdCB3YXMgc2V0IGJ5IEFNLiBGb3IgY29tcGxldGUgbGlzdCBvZiByZW1vdmUqIG1ldGhvZHMgc2VlIHRoZSBKYXZhRG9jCi8vIGZvciBvcmcuZm9yZ2Vyb2NrLm9hdXRoMi5jb3JlLkFjY2Vzc1Rva2VuIGNsYXNzLgphY2Nlc3NUb2tlbi5yZW1vdmVUb2tlbk5hbWUoKQoqLw==",
    "default" : false,
    "language" : "GROOVY",
    "context" : "OAUTH2_ACCESS_TOKEN_MODIFICATION",
    "createdBy" : "null",
    "creationDate" : 0,
    "lastModifiedBy" : "null",
    "lastModifiedDate" : 0
  }
}